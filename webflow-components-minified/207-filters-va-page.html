<!-- FILTERS SECTION FOR OUR CURRENT VAs PAGE -->
<!-- Based on VAFilters.jsx component - Updated with button toggles -->

<!-- 
  CONFIGURACIÃ“N: Usar el campo "main-category" (Plain Text) existente
  -------------------------------------------------------------------
  
  El cÃ³digo usa el campo "main-category" (Plain Text) que ya existe en tu colecciÃ³n.
  Este campo puede contener mÃºltiples categorÃ­as separadas por comas, por ejemplo:
  - "Executive Virtual Assistant, Healthcare Virtual Assistant, Insurance Virtual Assistant"
  
  El filtro funciona con bÃºsqueda parcial (contains), asÃ­ que si seleccionas:
  - "Insurance Virtual Assistant" â†’ mostrarÃ¡ todos los VAs que tengan "Insurance Virtual Assistant" 
    en su campo main-category, incluso si tienen otras categorÃ­as tambiÃ©n.
  
  PASOS:
  1. En Webflow Designer, abre tu Collection List y el Collection Item (card)
  2. AsegÃºrate de que el campo "main-category" estÃ© agregado a la card
     (puede estar visible u oculto - si estÃ¡ visible, estÃ¡ bien, si quieres ocultarlo,
      agrega la clase "va-main-category-hidden")
  3. En el CMS, asegÃºrate de que cada VA tenga su campo "main-category" con valores como:
     - "Insurance Virtual Assistant"
     - "Executive Virtual Assistant, Healthcare Virtual Assistant"
     - "Marketing Virtual Assistant"
     - etc.
  4. Guarda y publica
  
  NOTA: El filtro busca si el campo contiene la categorÃ­a seleccionada, no requiere
  coincidencia exacta. Esto permite que VAs con mÃºltiples categorÃ­as funcionen correctamente.
-->

<style>
    .va-filters {
      background: white;
      padding: 32px 20px;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 80px;
      z-index: 50;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
  
    .va-filters.sticky-active {
      position: fixed;
      left: 0;
      right: 0;
      width: 100%;
      top: 80px;
      z-index: 50;
      padding: 16px 20px;
    }
  
    .va-filters.sticky-active .va-filters-container {
      max-width: 1400px;
      margin: 0 auto;
      gap: 20px;
    }
  
    .va-filters.sticky-active .va-filter-label {
      margin-bottom: 8px;
      font-size: 11px;
    }
  
    .va-filters.sticky-active .va-filter-button {
      padding: 6px 14px;
      font-size: 13px;
    }
  
    .va-filters.sticky-active .va-search-input {
      padding: 8px 12px;
      font-size: 13px;
    }
  
    .va-filters-container {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 32px;
      align-items: end;
    }

    .va-results-counter {
      text-align: right;
      font-size: 14px;
      color: #6b7280;
      font-weight: 500;
      padding-bottom: 0;
      white-space: nowrap;
    }
  
    .va-filter-toggle {
      display: none;
    }
  
    .va-filter-group {
      display: flex;
      flex-direction: column;
    }
  
    .va-filter-label {
      font-size: 12px;
      font-weight: 700;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }
  
    .va-filter-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
  
    .va-filter-button {
      padding: 8px 16px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      color: #374151;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
  
    .va-filter-button:hover {
      border-color: #049d98;
      color: #049d98;
    }
  
    .va-filter-button.active {
      background: #049d98;
      color: white;
      border-color: #049d98;
    }
  
    .va-filter-button.active:hover {
      background: #037b77;
      border-color: #037b77;
    }
  
    .va-search-input {
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s ease;
      background: white;
      color: #374151;
    }
  
    .va-search-input:focus {
      outline: none;
      border-color: #049d98;
      box-shadow: 0 0 0 3px rgba(4, 157, 152, 0.1);
    }
  
    .va-search-input::placeholder {
      color: #9ca3af;
    }
  
    .va-category-select {
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s ease;
      background: white;
      color: #374151;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }
  
    .va-category-select:focus {
      outline: none;
      border-color: #049d98;
      box-shadow: 0 0 0 3px rgba(4, 157, 152, 0.1);
    }
  
    .va-category-select:hover {
      border-color: #049d98;
    }
  
    /* Hide main-category field in VA cards (for filtering purposes) */
    .va-main-category-hidden {
      display: none !important;
      visibility: hidden !important;
      position: absolute !important;
      width: 0 !important;
      height: 0 !important;
      opacity: 0 !important;
      overflow: hidden !important;
    }
  
    /* Alternative: If you use a class name, you can also use this */
    [data-field="main-category"].hidden-field,
    .main-category-field.hidden {
      display: none !important;
    }
  
    /* Tablet */
    @media (max-width: 1024px) {
      .va-filters-container {
        grid-template-columns: 1fr 1fr;
        gap: 24px;
      }

      .va-results-counter {
        grid-column: 1 / -1;
        text-align: left;
        margin-top: 8px;
      }
    }
  
    .va-filter-toggle {
      display: none;
      width: 100%;
      padding: 12px 16px;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      color: #374151;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
  
    .va-filter-toggle:hover {
      border-color: #049d98;
      color: #049d98;
    }
  
    .va-filter-toggle-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease;
      font-size: 10px;
      color: #6b7280;
    }
  
    .va-filter-toggle.active .va-filter-toggle-icon {
      transform: rotate(180deg);
    }
  
    /* Mobile */
    @media (max-width: 640px) {
      .va-filters {
        padding: 16px;
      }
  
      .va-filter-toggle {
        display: flex;
        margin-bottom: 0;
      }
  
      .va-filters-container {
        display: none;
        grid-template-columns: 1fr;
        gap: 20px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
      }
  
      .va-filters-container.mobile-open {
        display: grid;
      }
  
      .va-filter-options {
        gap: 6px;
      }
  
      .va-filter-button {
        padding: 8px 12px;
        font-size: 13px;
      }
  
      .va-filters.sticky-active {
        padding: 12px 16px;
      }
  
      .va-filters.sticky-active .va-filters-container {
        margin-top: 12px;
        padding-top: 12px;
      }
    }
  </style>
  
  <section class="va-filters">
    <button class="va-filter-toggle" type="button" aria-controls="va-filters-container" aria-expanded="false" id="filterToggle">
      <span>Filter by</span>
      <span class="va-filter-toggle-icon">
        <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
        </svg>
      </span>
    </button>
    <div class="va-filters-container" id="va-filters-container">
      <!-- Language Filter -->
      <div class="va-filter-group">
        <label class="va-filter-label">Language</label>
        <div class="va-filter-options" id="languageOptions">
          <button type="button" class="va-filter-button active" data-filter="language" data-value="All">All</button>
          <button type="button" class="va-filter-button" data-filter="language" data-value="English">English</button>
          <button type="button" class="va-filter-button" data-filter="language" data-value="Bilingual (EN-ES)">Bilingual (EN-ES)</button>
        </div>
      </div>
  
      <!-- Search Input -->
      <div class="va-filter-group">
        <label class="va-filter-label">Search by Keyword</label>
        <input 
          type="text" 
          class="va-search-input" 
          id="searchInput" 
          placeholder="Search by keyword (name, skills, tools, experience...)"
          autocomplete="off"
        >
      </div>

      <!-- Results Counter -->
      <div class="va-filter-group" style="display: flex; flex-direction: column; justify-content: flex-end;">
        <div id="va-results-counter" class="va-results-counter">
          Showing 62 of 62 VAs
        </div>
      </div>
  
    </div>
  </section>
  
  <script>
    // Get filter elements
    const searchInput = document.getElementById('searchInput');
    const languageButtons = document.querySelectorAll('[data-filter="language"]');
  
    // Store current filters
    let currentFilters = {
      search: '',
      language: 'All'
    };
  
  
    // Function to dispatch filter change event
    function dispatchFilterChange() {
      const event = new CustomEvent('vaFiltersChanged', {
        detail: currentFilters,
        bubbles: true
      });
      document.dispatchEvent(event);
      console.log('Filters changed:', currentFilters);
    }
  
    // Handle language button clicks
    languageButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        
        // Remove active class from all language buttons
        languageButtons.forEach(btn => btn.classList.remove('active'));
        
        // Add active class to clicked button
        button.classList.add('active');
        
        // Update filter
        currentFilters.language = button.dataset.value;
        
        // Dispatch event
        dispatchFilterChange();
      });
    });
  
    // Handle search input - real-time filtering
    searchInput.addEventListener('input', (e) => {
      currentFilters.search = e.target.value.trim();
      dispatchFilterChange();
    });
  
    // Allow Enter key in search
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        dispatchFilterChange();
      }
    });
  
  
    console.log('VA Filters initialized');
  </script>
  
  <script>
  /**
   * Mobile Filter Toggle
   * Handles the mobile dropdown toggle for filters
   */
  (function() {
    const filterToggle = document.getElementById('filterToggle');
    const filtersContainer = document.getElementById('va-filters-container');
    
    if (!filterToggle || !filtersContainer) return;
    
    filterToggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const isOpen = filtersContainer.classList.contains('mobile-open');
      
      if (isOpen) {
        filtersContainer.classList.remove('mobile-open');
        filterToggle.classList.remove('active');
        filterToggle.setAttribute('aria-expanded', 'false');
      } else {
        filtersContainer.classList.add('mobile-open');
        filterToggle.classList.add('active');
        filterToggle.setAttribute('aria-expanded', 'true');
      }
    });
    
    // Close on outside click (optional)
    document.addEventListener('click', function(e) {
      if (!filterToggle.contains(e.target) && !filtersContainer.contains(e.target)) {
        if (window.innerWidth <= 640) {
          filtersContainer.classList.remove('mobile-open');
          filterToggle.classList.remove('active');
          filterToggle.setAttribute('aria-expanded', 'false');
        }
      }
    });
    
    // Handle window resize - show filters on desktop, hide toggle
    function handleResize() {
      if (window.innerWidth > 640) {
        filtersContainer.classList.add('mobile-open');
        filterToggle.classList.remove('active');
        filterToggle.setAttribute('aria-expanded', 'false');
      }
    }
    
    window.addEventListener('resize', handleResize);
    
    // Initial check
    handleResize();
    
    console.log('Mobile filter toggle initialized');
  })();
  </script>
  
  <script>
  /**
   * Sticky Filter Enhancement
   * Makes the filter section stay visible even when scrolling past its container
   * and respects the navbar height
   */
  (function() {
    const filtersSection = document.querySelector('.va-filters');
    if (!filtersSection) return;
    
    let initialOffsetTop = null;
    let navbarHeight = null;
    let isFixed = false;
    
    // Detect navbar height dynamically
    function getNavbarHeight() {
      if (navbarHeight !== null) return navbarHeight;
      
      // Try common navbar selectors
      const navbar = document.querySelector('nav') || 
                    document.querySelector('.navbar') || 
                    document.querySelector('[class*="nav"]') ||
                    document.querySelector('header');
      
      if (navbar) {
        const height = navbar.offsetHeight || navbar.clientHeight;
        if (height > 0) {
          navbarHeight = height;
          return navbarHeight;
        }
      }
      
      // Default fallback
      navbarHeight = 80;
      return navbarHeight;
    }
    
    // Initialize the initial position
    function initializePosition() {
      if (initialOffsetTop === null) {
        initialOffsetTop = filtersSection.offsetTop;
      }
      const navHeight = getNavbarHeight();
      filtersSection.style.top = navHeight + 'px';
      
      // Update the sticky-active class top as well
      const styleId = 'va-filters-sticky-style';
      let style = document.getElementById(styleId);
      if (!style) {
        style = document.createElement('style');
        style.id = styleId;
        document.head.appendChild(style);
      }
      style.textContent = `
        .va-filters.sticky-active {
          top: ${navHeight}px !important;
        }
      `;
    }
    
    // Check if filters should be fixed - improved logic
    function checkStickyPosition() {
      if (initialOffsetTop === null) {
        initializePosition();
        return;
      }
      
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const navHeight = getNavbarHeight();
      const shouldBeFixed = scrollTop >= initialOffsetTop - navHeight;
      
      // Only toggle if state needs to change (prevents flickering)
      if (shouldBeFixed && !isFixed) {
        filtersSection.classList.add('sticky-active');
        isFixed = true;
      } else if (!shouldBeFixed && isFixed) {
        filtersSection.classList.remove('sticky-active');
        isFixed = false;
      }
    }
    
    // Initialize
    function init() {
      initializePosition();
      // Wait a bit for page to fully load
      setTimeout(() => {
        initialOffsetTop = filtersSection.offsetTop;
        checkStickyPosition();
      }, 100);
    }
    
    // Update on scroll with throttling
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          checkStickyPosition();
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });
    
    // Update on resize (navbar might change height)
    window.addEventListener('resize', () => {
      navbarHeight = null; // Reset to recalculate
      initialOffsetTop = filtersSection.offsetTop; // Recalculate initial position
      initializePosition();
      checkStickyPosition();
    });
    
    // Initialize on load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
    console.log('Sticky filter enhancement initialized');
  })();
  </script>
  
  <script>
  /**
   * VA Grid Filter Listener - Webflow Native Collections
   * Listens to filter changes and filters Webflow collection cards
   * 
   * Works with Webflow CMS collection items displayed as cards
   * Reads data from Webflow field attributes
   */
  
  (function() {
    // Store current filters
    let activeFilters = {
      search: '',
      language: 'All'
    };
    
    // Function to update results counter
    function updateResultsCounter(visibleCount, totalCount) {
      let counter = document.getElementById('va-results-counter');
      
      if (!counter) {
        // Try to find the results counter placeholder in the filters container
        const filtersContainer = document.querySelector('.va-filters-container');
        if (filtersContainer) {
          // Find or create the counter group
          let counterGroup = Array.from(filtersContainer.querySelectorAll('.va-filter-group'))
            .find(group => group.querySelector('#va-results-counter'));
          
          if (!counterGroup) {
            counterGroup = document.createElement('div');
            counterGroup.className = 'va-filter-group';
            counterGroup.style.display = 'flex';
            counterGroup.style.flexDirection = 'column';
            counterGroup.style.justifyContent = 'flex-end';
            filtersContainer.appendChild(counterGroup);
          }
          
          counter = document.createElement('div');
          counter.id = 'va-results-counter';
          counter.className = 'va-results-counter';
          counterGroup.appendChild(counter);
        }
      }
      
      if (counter) {
        if (visibleCount === 0) {
          counter.textContent = 'No VAs found matching your filters';
          counter.style.color = '#ef4444';
        } else {
          counter.textContent = `Showing ${visibleCount} of ${totalCount} VA${totalCount !== 1 ? 's' : ''}`;
          counter.style.color = '#6b7280';
        }
      }
    }
  
    // Function to get field value from Webflow card
    // This function will find the field even if it's hidden with CSS
    // Works with: Plain Text, Option, Rich Text, and other field types
    function getFieldValue(card, fieldClass) {
      // Try multiple selectors for flexibility (including hidden elements)
      // querySelector finds elements even if they have display:none
      const element = card.querySelector(`[data-field="${fieldClass}"]`) || 
                     card.querySelector(`[data-wf-field="${fieldClass}"]`) ||
                     card.querySelector(`[data-wf-field="${fieldClass.replace('-', '')}"]`) ||
                     card.querySelector(`.${fieldClass}`) ||
                     card.querySelector(`[class*="${fieldClass}"]`) ||
                     card.querySelector(`[class*="${fieldClass.replace('-', '_')}"]`);
      
      if (!element) {
        // Debug: log if field not found (only for main-category to help troubleshoot)
        if (fieldClass === 'main-category') {
          console.warn('main-category field not found in card. Make sure you added the field to the card design in Webflow.');
          console.warn('The field can be Option or Plain Text type, but must be added to the card design.');
        }
        return '';
      }
      
      let text = element.textContent.trim();
      
      // Remove common icons and emojis
      text = text.replace(/[\u{1F300}-\u{1F9FF}]/gu, ''); // Emojis
      text = text.replace(/[ðŸŒðŸ“ðŸ’¼ðŸŽ¯ðŸ“…]/g, ''); // Specific icons
      text = text.replace(/^\s+|\s+$/g, ''); // Trim again after removing icons
      
      return text;
    }
  
    // Function to filter VA cards
    function filterVACards() {
      console.log('\n=== FILTERING VA CARDS ===');
      console.log('Active filters:', activeFilters);
      
      // Find all Webflow collection items - be more specific to avoid counting other collections
      // Look for VA cards that have the name field
      const cards = Array.from(document.querySelectorAll('.w-dyn-item')).filter(card => {
        // Only count cards that have VA-specific fields (name field)
        return card.textContent.includes('EXPERIENCE') && card.textContent.includes('LANGUAGE');
      });
      
      console.log(`Found ${cards.length} VA cards to filter`);
      
      let visibleCount = 0;
  
      if (cards.length === 0) {
        console.warn('No VA collection items found. Make sure your collection is rendered.');
        return;
      }
  
        // Debug: Log first card structure
        if (cards.length > 0) {
          console.log('First card HTML:', cards[0].innerHTML);
          console.log('First card classes:', cards[0].className);
          console.log('All text content:', cards[0].textContent);
        }
  
      cards.forEach((card, index) => {
        // Get VA data from Webflow fields
        // Adjust these selectors based on your Webflow collection structure
        const name = getFieldValue(card, 'name').toLowerCase();
        const availability = getFieldValue(card, 'availability');
        
        // Language field - try multiple approaches
        let language = getFieldValue(card, 'languages') || getFieldValue(card, 'language');
        
        // If still empty, extract from text content after "LANGUAGE" label
        if (!language) {
          const textContent = card.textContent;
          const languageIndex = textContent.indexOf('LANGUAGE');
          if (languageIndex !== -1) {
            const afterLanguage = textContent.substring(languageIndex + 8).trim();
            // Extract language - look for common patterns
            if (afterLanguage.includes('Bilingual')) {
              language = 'Bilingual (EN-ES)';
            } else if (afterLanguage.includes('English')) {
              language = 'English';
            } else {
              // Fallback: get first 50 chars
              language = afterLanguage.substring(0, 50).trim();
            }
          }
        }
        
        // Get main-category field (plain text field that can contain multiple categories separated by commas)
        // Example: "Executive Virtual Assistant, Healthcare Virtual Assistant, Insurance Virtual Assistant"
        const mainCategory = getFieldValue(card, 'main-category') || '';
        
        // Get title/position
        const title = getFieldValue(card, 'title') || '';
        
        // Get experience years
        const experienceYears = getFieldValue(card, 'experience-years') || '';
        
        // Extract skills/specializations from tags
        const skillTags = card.querySelectorAll('.va-grid-tag, .va-skill-tag, [class*="skill"], [class*="specialization"]');
        const skillsArray = Array.from(skillTags).map(tag => tag.textContent.trim().toLowerCase()).filter(Boolean);
        const skillsText = skillsArray.join(' ');
        
        // Extract tools from tags (if they exist in cards)
        const toolTags = card.querySelectorAll('[class*="tool"], [class*="va-tool"]');
        const toolsArray = Array.from(toolTags).map(tag => tag.textContent.trim().toLowerCase()).filter(Boolean);
        const toolsText = toolsArray.join(' ');
        
        // Build comprehensive searchable text from all card fields
        // Combine all searchable content into one string
        const searchableContent = [
          name,                                    // Name
          title.toLowerCase(),                     // Title/Position
          mainCategory.toLowerCase(),              // Main Category
          language.toLowerCase(),                  // Language
          availability.toLowerCase(),              // Availability
          experienceYears.toLowerCase(),           // Experience Years
          skillsText,                              // Skills/Specializations
          toolsText                                // Tools
        ].filter(Boolean).join(' ');
  
        // Check search filter - search across all fields
        const searchTerm = activeFilters.search.toLowerCase().trim();
        const searchMatch = !searchTerm || searchableContent.includes(searchTerm);
  
        // Check language filter
        const languageMatch = activeFilters.language === 'All' || 
                             (language && language.includes(activeFilters.language));
  
        // Show/hide card based on all filters
        const shouldShow = searchMatch && languageMatch;
        
        if (shouldShow) {
          card.style.display = '';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });
  
      // Update counter
      updateResultsCounter(visibleCount, cards.length);
      console.log(`\n=== FILTERING COMPLETE ===`);
      console.log(`Showing ${visibleCount} out of ${cards.length} VA cards`);
      console.log(`Active filters:`, activeFilters);
      
    }
  
    // Listen for filter changes
    document.addEventListener('vaFiltersChanged', (e) => {
      activeFilters = e.detail;
      console.log('Grid received filter update:', activeFilters);
      filterVACards();
    });
  
    // Initial filter on page load
    window.addEventListener('load', () => {
      filterVACards();
    });
  
    console.log('VA Grid Filter Listener initialized for Webflow collections');
  })();
  
  </script>