<!-- FILTERS SECTION FOR OUR CURRENT VAs PAGE -->
<!-- Based on VAFilters.jsx component - Updated with button toggles -->

<!-- 
  CONFIGURACIÃ“N: Usar el campo "main-category" (Plain Text) existente
  -------------------------------------------------------------------
  
  El cÃ³digo usa el campo "main-category" (Plain Text) que ya existe en tu colecciÃ³n.
  Este campo puede contener mÃºltiples categorÃ­as separadas por comas, por ejemplo:
  - "Executive Virtual Assistant, Healthcare Virtual Assistant, Insurance Virtual Assistant"
  
  El filtro funciona con bÃºsqueda parcial (contains), asÃ­ que si seleccionas:
  - "Insurance Virtual Assistant" â†’ mostrarÃ¡ todos los VAs que tengan "Insurance Virtual Assistant" 
    en su campo main-category, incluso si tienen otras categorÃ­as tambiÃ©n.
  
  PASOS:
  1. En Webflow Designer, abre tu Collection List y el Collection Item (card)
  2. AsegÃºrate de que el campo "main-category" estÃ© agregado a la card
     (puede estar visible u oculto - si estÃ¡ visible, estÃ¡ bien, si quieres ocultarlo,
      agrega la clase "va-main-category-hidden")
  3. En el CMS, asegÃºrate de que cada VA tenga su campo "main-category" con valores como:
     - "Insurance Virtual Assistant"
     - "Executive Virtual Assistant, Healthcare Virtual Assistant"
     - "Marketing Virtual Assistant"
     - etc.
  4. Guarda y publica
  
  NOTA: El filtro busca si el campo contiene la categorÃ­a seleccionada, no requiere
  coincidencia exacta. Esto permite que VAs con mÃºltiples categorÃ­as funcionen correctamente.
-->

<style>
  .va-filters {
    background: white;
    padding: 32px 20px;
    border-bottom: 1px solid #e5e7eb;
  }

  .va-filters-container {
    max-width: 1400px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 32px;
  }

  .va-filter-group {
    display: flex;
    flex-direction: column;
  }

  .va-filter-label {
    font-size: 12px;
    font-weight: 700;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
  }

  .va-filter-options {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .va-filter-button {
    padding: 8px 16px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    background: white;
    color: #374151;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .va-filter-button:hover {
    border-color: #049d98;
    color: #049d98;
  }

  .va-filter-button.active {
    background: #049d98;
    color: white;
    border-color: #049d98;
  }

  .va-filter-button.active:hover {
    background: #037b77;
    border-color: #037b77;
  }

  .va-search-input {
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    font-family: inherit;
    transition: all 0.2s ease;
    background: white;
    color: #374151;
  }

  .va-search-input:focus {
    outline: none;
    border-color: #049d98;
    box-shadow: 0 0 0 3px rgba(4, 157, 152, 0.1);
  }

  .va-search-input::placeholder {
    color: #9ca3af;
  }

  .va-category-select {
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    font-family: inherit;
    transition: all 0.2s ease;
    background: white;
    color: #374151;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 36px;
  }

  .va-category-select:focus {
    outline: none;
    border-color: #049d98;
    box-shadow: 0 0 0 3px rgba(4, 157, 152, 0.1);
  }

  .va-category-select:hover {
    border-color: #049d98;
  }

  /* Hide main-category field in VA cards (for filtering purposes) */
  .va-main-category-hidden {
    display: none !important;
    visibility: hidden !important;
    position: absolute !important;
    width: 0 !important;
    height: 0 !important;
    opacity: 0 !important;
    overflow: hidden !important;
  }

  /* Alternative: If you use a class name, you can also use this */
  [data-field="main-category"].hidden-field,
  .main-category-field.hidden {
    display: none !important;
  }

  /* Tablet */
  @media (max-width: 1024px) {
    .va-filters-container {
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
  }

  /* Mobile */
  @media (max-width: 640px) {
    .va-filters {
      padding: 24px 16px;
    }

    .va-filters-container {
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .va-filter-options {
      gap: 6px;
    }

    .va-filter-button {
      padding: 8px 12px;
      font-size: 13px;
    }
  }
</style>

<section class="va-filters">
  <div class="va-filters-container">
    <!-- Availability Filter -->
    <div class="va-filter-group">
      <label class="va-filter-label">Availability</label>
      <div class="va-filter-options" id="availabilityOptions">
        <button type="button" class="va-filter-button active" data-filter="availability" data-value="All">All</button>
        <button type="button" class="va-filter-button" data-filter="availability" data-value="Full Time">Full Time</button>
        <button type="button" class="va-filter-button" data-filter="availability" data-value="Part Time">Part Time</button>
        <button type="button" class="va-filter-button" data-filter="availability" data-value="Assigned">Assigned</button>
      </div>
    </div>

    <!-- Language Filter -->
    <div class="va-filter-group">
      <label class="va-filter-label">Language</label>
      <div class="va-filter-options" id="languageOptions">
        <button type="button" class="va-filter-button active" data-filter="language" data-value="All">All</button>
        <button type="button" class="va-filter-button" data-filter="language" data-value="English">English</button>
        <button type="button" class="va-filter-button" data-filter="language" data-value="Bilingual (EN-ES)">Bilingual (EN-ES)</button>
      </div>
    </div>

    <!-- Search Input -->
    <div class="va-filter-group">
      <label class="va-filter-label">Search by Name</label>
      <input 
        type="text" 
        class="va-search-input" 
        id="searchInput" 
        placeholder="Search VA name..."
        autocomplete="off"
      >
    </div>

    <!-- Main Category Filter -->
    <div class="va-filter-group">
      <label class="va-filter-label">Main Category</label>
      <select 
        class="va-category-select" 
        id="categorySelect"
      >
        <option value="All">All Categories</option>
        <!-- Options will be populated dynamically -->
      </select>
    </div>
  </div>
</section>

<!-- Results Counter -->
<div id="va-results-counter" style="
  text-align: center;
  padding: 24px 20px;
  margin: 20px 0;
  font-size: 14px;
  color: #6b7280;
  font-weight: 500;
  border-bottom: 1px solid #e5e7eb;
">
  Showing 62 of 62 VAs
</div>

<script>
  // Get filter elements
  const searchInput = document.getElementById('searchInput');
  const categorySelect = document.getElementById('categorySelect');
  const availabilityButtons = document.querySelectorAll('[data-filter="availability"]');
  const languageButtons = document.querySelectorAll('[data-filter="language"]');

  // Store current filters
  let currentFilters = {
    search: '',
    availability: 'All',
    language: 'All',
    mainCategory: 'All'
  };


  // Manual list of main categories
  const MAIN_CATEGORIES = [
    'Mortgage Specialist',
    'Marketing Virtual Assistant',
    'Insurance Virtual Assistant',
    'Healthcare Virtual Assistant',
    'Executive Virtual Assistant'
  ];

  // Function to populate category dropdown with manual categories
  function populateCategoryDropdown() {
    const categorySelect = document.getElementById('categorySelect');
    if (!categorySelect) {
      console.warn('Category select element not found');
      return;
    }
    
    // Clear existing options
    categorySelect.innerHTML = '<option value="All">All Categories</option>';
    
    // Add manual categories as options
    MAIN_CATEGORIES.forEach(category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      categorySelect.appendChild(option);
      
      // Log each category being added
      console.log('Added category to dropdown:', {
        value: category,
        length: category.length,
        chars: Array.from(category).map(c => `${c}(${c.charCodeAt(0)})`).join(' ')
      });
    });

    console.log('Categories dropdown populated with', MAIN_CATEGORIES.length, 'categories:', MAIN_CATEGORIES);
    console.log('Dropdown options:', Array.from(categorySelect.options).map(opt => ({
      value: opt.value,
      text: opt.textContent
    })));
  }

  // Make function globally accessible
  window.populateCategoryDropdown = populateCategoryDropdown;

  // Function to dispatch filter change event
  function dispatchFilterChange() {
    const event = new CustomEvent('vaFiltersChanged', {
      detail: currentFilters,
      bubbles: true
    });
    document.dispatchEvent(event);
    console.log('Filters changed:', currentFilters);
  }

  // Handle availability button clicks
  availabilityButtons.forEach(button => {
    button.addEventListener('click', (e) => {
      e.preventDefault();
      
      // Remove active class from all availability buttons
      availabilityButtons.forEach(btn => btn.classList.remove('active'));
      
      // Add active class to clicked button
      button.classList.add('active');
      
      // Update filter
      currentFilters.availability = button.dataset.value;
      
      // Dispatch event
      dispatchFilterChange();
    });
  });

  // Handle language button clicks
  languageButtons.forEach(button => {
    button.addEventListener('click', (e) => {
      e.preventDefault();
      
      // Remove active class from all language buttons
      languageButtons.forEach(btn => btn.classList.remove('active'));
      
      // Add active class to clicked button
      button.classList.add('active');
      
      // Update filter
      currentFilters.language = button.dataset.value;
      
      // Dispatch event
      dispatchFilterChange();
    });
  });

  // Handle search input - real-time filtering
  searchInput.addEventListener('input', (e) => {
    currentFilters.search = e.target.value.trim();
    dispatchFilterChange();
  });

  // Allow Enter key in search
  searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      dispatchFilterChange();
    }
  });

  // Handle category dropdown change
  categorySelect.addEventListener('change', (e) => {
    const selectedValue = e.target.value;
    console.log('Category dropdown changed to:', selectedValue);
    currentFilters.mainCategory = selectedValue;
    dispatchFilterChange();
  });

  // Populate categories immediately (no need to wait for collection)
  function initializeCategories() {
    populateCategoryDropdown();
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeCategories);
  } else {
    initializeCategories();
  }

  console.log('VA Filters initialized');
</script>

<script>
/**
 * VA Grid Filter Listener - Webflow Native Collections
 * Listens to filter changes and filters Webflow collection cards
 * 
 * Works with Webflow CMS collection items displayed as cards
 * Reads data from Webflow field attributes
 */

(function() {
  // Store current filters
  let activeFilters = {
    search: '',
    availability: 'All',
    language: 'All',
    mainCategory: 'All'
  };
  
  // Function to update results counter
  function updateResultsCounter(visibleCount, totalCount) {
    let counter = document.getElementById('va-results-counter');
    
    if (!counter) {
      // Try multiple selectors to find collection wrapper
      let collectionWrapper = document.querySelector('.w-dyn-list') || 
                             document.querySelector('[data-w-id]') ||
                             document.querySelector('[role="region"]') ||
                             document.querySelector('main') ||
                             document.body;
      
      if (collectionWrapper) {
        counter = document.createElement('div');
        counter.id = 'va-results-counter';
        counter.style.cssText = `
          text-align: center;
          padding: 24px 20px;
          margin: 20px 0;
          font-size: 14px;
          color: #6b7280;
          font-weight: 500;
          border-bottom: 1px solid #e5e7eb;
        `;
        
        // Insert before the collection wrapper or at the top
        if (collectionWrapper.parentNode) {
          collectionWrapper.parentNode.insertBefore(counter, collectionWrapper);
        } else {
          collectionWrapper.insertBefore(counter, collectionWrapper.firstChild);
        }
      }
    }
    
    if (counter) {
      if (visibleCount === 0) {
        counter.textContent = 'No VAs found matching your filters';
        counter.style.color = '#ef4444';
      } else {
        counter.textContent = `Showing ${visibleCount} of ${totalCount} VA${totalCount !== 1 ? 's' : ''}`;
        counter.style.color = '#6b7280';
      }
    }
  }

  // Function to get field value from Webflow card
  // This function will find the field even if it's hidden with CSS
  // Works with: Plain Text, Option, Rich Text, and other field types
  function getFieldValue(card, fieldClass) {
    // Try multiple selectors for flexibility (including hidden elements)
    // querySelector finds elements even if they have display:none
    const element = card.querySelector(`[data-field="${fieldClass}"]`) || 
                   card.querySelector(`[data-wf-field="${fieldClass}"]`) ||
                   card.querySelector(`[data-wf-field="${fieldClass.replace('-', '')}"]`) ||
                   card.querySelector(`.${fieldClass}`) ||
                   card.querySelector(`[class*="${fieldClass}"]`) ||
                   card.querySelector(`[class*="${fieldClass.replace('-', '_')}"]`);
    
    if (!element) {
      // Debug: log if field not found (only for main-category to help troubleshoot)
      if (fieldClass === 'main-category') {
        console.warn('main-category field not found in card. Make sure you added the field to the card design in Webflow.');
        console.warn('The field can be Option or Plain Text type, but must be added to the card design.');
      }
      return '';
    }
    
    let text = element.textContent.trim();
    
    // Remove common icons and emojis
    text = text.replace(/[\u{1F300}-\u{1F9FF}]/gu, ''); // Emojis
    text = text.replace(/[ðŸŒðŸ“ðŸ’¼ðŸŽ¯ðŸ“…]/g, ''); // Specific icons
    text = text.replace(/^\s+|\s+$/g, ''); // Trim again after removing icons
    
    return text;
  }

  // Diagnostic function to check if main-category field is working
  // Call this in browser console: window.checkMainCategoryField()
  window.checkMainCategoryField = function() {
    const cards = Array.from(document.querySelectorAll('.w-dyn-item')).filter(card => {
      return card.textContent.includes('EXPERIENCE') && card.textContent.includes('LANGUAGE');
    });
    
    if (cards.length === 0) {
      console.warn('No VA cards found');
      return;
    }
    
    console.log('=== MAIN CATEGORY FIELD DIAGNOSIS ===');
    console.log(`Checking ${cards.length} VA cards...`);
    console.log('The filter uses partial matching (contains) - it will match if the field contains the selected category.\n');
    
    const results = [];
    const allCategories = new Set();
    
    cards.forEach((card, index) => {
      const mainCategoryField = getFieldValue(card, 'main-category');
      const mainCategoryElement = card.querySelector('[data-field="main-category"]');
      
      // Test filtering with each available category
      const testCategories = [
        'Mortgage Specialist',
        'Marketing Virtual Assistant',
        'Insurance Virtual Assistant',
        'Healthcare Virtual Assistant',
        'Executive Virtual Assistant'
      ];
      
      const matches = testCategories.filter(cat => {
        return mainCategoryField && mainCategoryField.toLowerCase().includes(cat.toLowerCase());
      });
      
      results.push({
        cardIndex: index,
        hasMainCategoryField: !!mainCategoryElement,
        mainCategoryValue: mainCategoryField || '(empty)',
        wouldMatchCategories: matches
      });
      
      // Extract individual categories from comma-separated values
      if (mainCategoryField) {
        const categories = mainCategoryField.split(',').map(c => c.trim());
        categories.forEach(cat => {
          if (cat) allCategories.add(cat);
        });
      }
      
      if (index < 5) {
        console.log(`Card ${index}:`, {
          mainCategory: mainCategoryField || '(empty)',
          hasField: !!mainCategoryElement,
          wouldMatch: matches.length > 0 ? matches : 'None'
        });
      }
    });
    
    const withField = results.filter(r => r.hasMainCategoryField).length;
    const withValue = results.filter(r => r.mainCategoryValue && r.mainCategoryValue !== '(empty)').length;
    const withMatches = results.filter(r => r.wouldMatchCategories.length > 0).length;
    
    console.log(`\nSummary:`);
    console.log(`- Cards with "main-category" field: ${withField}/${cards.length}`);
    console.log(`- Cards with values: ${withValue}/${cards.length}`);
    console.log(`- Cards that would match at least one category: ${withMatches}/${cards.length}`);
    
    if (withField === 0) {
      console.error('âŒ No cards have "main-category" field! Add it to your card design in Webflow.');
    } else if (withValue === 0) {
      console.warn('âš ï¸ Field exists but has no values. Add categories in Webflow CMS.');
    } else if (withMatches === 0) {
      console.warn('âš ï¸ Field has values but none match the filter categories. Check category names.');
    } else {
      console.log('âœ… Category filtering is working!');
    }
    
    // Show all unique categories found in the field
    console.log(`\nAll unique categories found in main-category field:`, Array.from(allCategories).sort());
    
    console.log('=== END DIAGNOSIS ===');
    return results;
  };

  // Function to filter VA cards
  function filterVACards() {
    console.log('\n=== FILTERING VA CARDS ===');
    console.log('Active filters:', activeFilters);
    
    // Find all Webflow collection items - be more specific to avoid counting other collections
    // Look for VA cards that have the name field
    const cards = Array.from(document.querySelectorAll('.w-dyn-item')).filter(card => {
      // Only count cards that have VA-specific fields (name field)
      return card.textContent.includes('EXPERIENCE') && card.textContent.includes('LANGUAGE');
    });
    
    console.log(`Found ${cards.length} VA cards to filter`);
    
    let visibleCount = 0;

    if (cards.length === 0) {
      console.warn('No VA collection items found. Make sure your collection is rendered.');
      return;
    }

    // Debug: Check first card for main-category field
    if (cards.length > 0) {
      const firstCard = cards[0];
      const mainCategoryElement = firstCard.querySelector('[data-field="main-category"]');
      const mainCategoryValue = getFieldValue(firstCard, 'main-category');
      console.log('First card - main-category element found:', !!mainCategoryElement);
      console.log('First card - main-category value:', mainCategoryValue || '(empty)');
      if (mainCategoryElement) {
        console.log('First card - main-category element HTML:', mainCategoryElement.outerHTML.substring(0, 200));
      }
    }

    cards.forEach((card, index) => {
      // Get VA data from Webflow fields
      // Adjust these selectors based on your Webflow collection structure
      const name = getFieldValue(card, 'name').toLowerCase();
      const availability = getFieldValue(card, 'availability');
      
      // Language field - try multiple approaches
      let language = getFieldValue(card, 'languages') || getFieldValue(card, 'language');
      
      // If still empty, extract from text content after "LANGUAGE" label
      if (!language) {
        const textContent = card.textContent;
        const languageIndex = textContent.indexOf('LANGUAGE');
        if (languageIndex !== -1) {
          const afterLanguage = textContent.substring(languageIndex + 8).trim();
          // Extract language - look for common patterns
          if (afterLanguage.includes('Bilingual')) {
            language = 'Bilingual (EN-ES)';
          } else if (afterLanguage.includes('English')) {
            language = 'English';
          } else {
            // Fallback: get first 50 chars
            language = afterLanguage.substring(0, 50).trim();
          }
        }
      }
      
      // Get main-category field (plain text field that can contain multiple categories separated by commas)
      // Example: "Executive Virtual Assistant, Healthcare Virtual Assistant, Insurance Virtual Assistant"
      const mainCategory = getFieldValue(card, 'main-category') || '';

      // Check search filter (search in name or main category)
      const searchTerm = activeFilters.search.toLowerCase();
      const searchMatch = !searchTerm || name.includes(searchTerm) || (mainCategory && mainCategory.toLowerCase().includes(searchTerm));

      // Check availability filter
      const availabilityMatch = activeFilters.availability === 'All' || 
                               (availability && availability.includes(activeFilters.availability));

      // Check language filter
      const languageMatch = activeFilters.language === 'All' || 
                           (language && language.includes(activeFilters.language));

      // Check main category filter - uses partial match (contains)
      // This allows filtering when main-category contains multiple values like:
      // "Executive Virtual Assistant, Healthcare Virtual Assistant"
      // It will match if any part of the field contains the selected category
      let categoryMatch = true; // Default to true (show all)
      
      if (activeFilters.mainCategory && activeFilters.mainCategory !== 'All') {
        if (!mainCategory || mainCategory.trim() === '') {
          // If field is empty and a category is selected, hide the card
          categoryMatch = false;
        } else {
          // Normalize both values: lowercase, trim, normalize spaces
          const normalizeText = (text) => {
            return text.toLowerCase()
                      .trim()
                      .replace(/\s+/g, ' ') // Replace multiple spaces with single space
                      .replace(/[,\-]/g, ' ') // Replace commas and dashes with spaces
                      .trim();
          };
          
          const categoryNormalized = normalizeText(activeFilters.mainCategory);
          const fieldNormalized = normalizeText(mainCategory);
          
          // Check if the field contains the selected category
          // Also check individual words in case of comma-separated values
          const categoryWords = categoryNormalized.split(/\s+/);
          const fieldWords = fieldNormalized.split(/\s+/);
          
          // Match if field contains the full category phrase OR all words of the category
          const fullMatch = fieldNormalized.includes(categoryNormalized);
          const wordMatch = categoryWords.every(word => 
            word.length > 2 && fieldWords.some(fieldWord => fieldWord.includes(word))
          );
          
          categoryMatch = fullMatch || wordMatch;
          
          // Debug for first few cards
          if (index < 3) {
            console.log('Category filter details:', {
              selectedCategory: activeFilters.mainCategory,
              fieldValue: mainCategory,
              categoryNormalized: categoryNormalized,
              fieldNormalized: fieldNormalized,
              fullMatch: fullMatch,
              wordMatch: wordMatch,
              finalMatch: categoryMatch
            });
          }
        }
      }

      // Debug first few cards to see what's happening
      if (index < 3 || (mainCategory && mainCategory.toLowerCase().includes('executive'))) {
        console.log(`\n=== Card ${index} Filter Check ===`);
        console.log('Filters active:', activeFilters);
        console.log('Card data:', {
          name: name,
          availability: availability,
          language: language,
          mainCategory: mainCategory || '(empty)',
          mainCategoryLength: mainCategory ? mainCategory.length : 0,
          mainCategoryChars: mainCategory ? Array.from(mainCategory).map(c => c.charCodeAt(0)) : []
        });
        console.log('Filter results:', {
          searchMatch: searchMatch,
          availabilityMatch: availabilityMatch,
          languageMatch: languageMatch,
          categoryMatch: categoryMatch
        });
        console.log('Will show:', searchMatch && availabilityMatch && languageMatch && categoryMatch);
        
        // Extra debug for category matching
        if (activeFilters.mainCategory && activeFilters.mainCategory !== 'All') {
          console.log('Category matching details:', {
            selected: activeFilters.mainCategory,
            field: mainCategory,
            selectedLower: activeFilters.mainCategory.toLowerCase(),
            fieldLower: mainCategory ? mainCategory.toLowerCase() : '',
            includesCheck: mainCategory ? mainCategory.toLowerCase().includes(activeFilters.mainCategory.toLowerCase()) : false
          });
        }
      }

      // Show/hide card based on all filters
      const shouldShow = searchMatch && availabilityMatch && languageMatch && categoryMatch;
      
      if (shouldShow) {
        card.style.display = '';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });

    // Update counter
    updateResultsCounter(visibleCount, cards.length);
    console.log(`\n=== FILTERING COMPLETE ===`);
    console.log(`Showing ${visibleCount} out of ${cards.length} VA cards`);
    console.log(`Active filters:`, activeFilters);
    
    if (visibleCount === 0 && cards.length > 0) {
      console.warn('\nâš ï¸ No cards visible! Possible issues:');
      console.warn('1. Check if main-category field is added to cards in Webflow');
      console.warn('2. Check if category values in CMS match the filter options');
      console.warn('3. Run window.checkMainCategoryField() in console to diagnose');
    }
    console.log('========================\n');
  }

  // Listen for filter changes
  document.addEventListener('vaFiltersChanged', (e) => {
    activeFilters = e.detail;
    console.log('Grid received filter update:', activeFilters);
    filterVACards();
  });

  // Initial filter on page load
  window.addEventListener('load', () => {
    filterVACards();
    // Try to populate categories when collection is ready
    if (window.populateCategoryDropdown) {
      setTimeout(() => {
        console.log('Attempting to populate categories from filter script...');
        window.populateCategoryDropdown();
      }, 1000);
    }
  });

  // Also try after filtering (collection might be ready then)
  setTimeout(() => {
    if (window.populateCategoryDropdown) {
      const cards = document.querySelectorAll('.w-dyn-item');
      if (cards.length > 0) {
        console.log('Populating categories after collection load...');
        window.populateCategoryDropdown();
      }
    }
  }, 2000);

  console.log('VA Grid Filter Listener initialized for Webflow collections');
})();

</script>